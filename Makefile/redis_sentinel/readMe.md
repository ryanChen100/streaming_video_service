
目前須先啟動redis-master
查詢redis-master ip
docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' redis-master

將查詢到的ip替換到sentinel-*.conf內的ip
之後再啟動sentinel service

否則會因為無法ping到redis-master
導致sentinel啟動失敗

哨兵模式
哨兵和 Replica 的独立性
	1.	哨兵节点的作用：
	•	监控主节点和所有从节点的健康状态。
	•	协调主节点的故障切换（包括选举新的主节点）。
	•	哨兵节点是逻辑上的管理者，不存储 Redis 数据。
	2.	从节点的作用：
	•	实现数据的主从同步，作为主节点的备份。
	•	可分担读操作，减轻主节点压力（读写分离）。
	•	从节点是物理数据的存储者。
	3.	哨兵与从节点的关系：
	•	哨兵节点监控整个 Redis 集群的状态，但哨兵数量与从节点数量并无直接关联。
	•	你可以拥有多个哨兵节点，而只有一个或两个从节点。

    为什么不需要增加从节点？
	•	哨兵是管理组件，不存储数据：
	•	哨兵节点增加是为了提高 Redis 集群的监控能力和故障切换的可靠性，与数据存储无关。
	•	从节点主要用于高可用和读写分离：
	•	从节点的数量取决于你的业务对 高可用性（备份） 和 读性能 的需求，而不是哨兵节点的数量。
	•	哨兵需要奇数配置：
	•	哨兵节点需要奇数个（如 3、5、7），以确保在选举主节点时有投票多数（Quorum）。

    推荐配置关系
	1.	标准配置：
	•	1 个主节点，2 个从节点，3 个哨兵节点。
	•	适合大多数生产环境，提供基本的高可用性。
	2.	增加哨兵节点：
	•	如果你希望提高哨兵的容错能力，可以增加哨兵节点数量到 5 个或更多。
	•	无需增加从节点，只需调整哨兵配置中的 quorum 参数。例如，5 个哨兵时，可以设置 quorum = 3。
	3.	增加从节点：
	•	增加从节点是为了实现更高的读性能或更高的容灾能力。
	•	从节点数量与哨兵数量无直接关系，可以根据需求单独增加。

    增加哨兵节点的配置步骤

假设你已经有 3 个哨兵节点（sentinel1, sentinel2, sentinel3），想增加到 5 个哨兵节点：
	1.	部署新的哨兵节点：
	•	在新服务器上部署 Redis Sentinel，配置文件示例如下：
    ```
    port 26382
    sentinel monitor mymaster 192.168.1.40 6379 2
    sentinel down-after-milliseconds mymaster 5000
    sentinel parallel-syncs mymaster 1
    sentinel failover-timeout mymaster 15000
    ```

	2.	启动新的哨兵节点：
    ```
    redis-sentinel /path/to/new-sentinel.conf
    ```

	3.	更新 quorum 参数：
	•	如果增加到 5 个哨兵节点，确保 quorum 设置为 3：
    ```
    sentinel monitor mymaster 192.168.1.40 6379 3
    ```

    4.	动态更新现有哨兵节点：
	•	让现有哨兵节点感知新哨兵，无需重启，它们会自动通过 Raft 协议同步。

增加从节点的场景和配置步骤

如果你的业务需要增加从节点以分担读压力或提高容灾能力，可以按以下步骤操作：
	1.	启动新从节点：
	•	在新服务器上启动 Redis 实例：
    ```
    port 6382
    replicaof 192.168.1.40 6379
    ```

    2.	让哨兵监控新从节点：
	•	哨兵会自动检测到新从节点并开始监控，无需额外配置。
	3.	验证同步状态：
	•	在主节点上执行：
    ```
    redis-cli -p 6379 INFO replication
    ```

推荐的最佳实践
	1.	哨兵数量和奇数原则：
	•	哨兵节点应为奇数个（3、5、7…），以保证故障切换时的投票多数。
	•	哨兵数量增加有助于提高管理的可靠性，但不要过多增加以免引入不必要的网络开销。
	2.	从节点的数量：
	•	增加从节点是为了解决读压力和数据备份需求，而不是为了匹配哨兵数量。
	•	从节点数量可以是哨兵节点数量的任何倍数或非倍数。

总结
	•	哨兵数量增加无需增加从节点，两者无直接绑定关系。
	•	从节点数量增加 是基于读性能和备份需求，而不是哨兵数量。
	•	哨兵主要提供高可用管理功能，从节点负责数据存储和同步，两者角色独立。